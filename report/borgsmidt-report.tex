%!TEX TS-program = xelatex
%!TEX encoding = UTF-8 Unicode

\documentclass[
paper=a4,
oneside,
fontsize=11pt,
numbers=noenddot,
headinclude=false, % Count header as margin
footinclude=false, % Count footer as margin
%mpinclude=true, % Include this to leave space for margin notes
fleqn,             % Equations on left instead of center
DIV=8
]{scrartcl}

\usepackage[automark]{scrpage2}
\makeatletter\@ifclassloaded{scrreprt}{%
  \pagestyle{scrheadings}%
  \setlength{\marginparwidth}{7em}%
  \setlength{\marginparsep}{2em}%
}\makeatother

\addtolength{\textheight}{35mm}

\usepackage[usenames,dvipsnames]{xcolor} %use color with the command \textcolor{spot}{some text to
%with your color previously defined}
\definecolor{seccol}{rgb}{0.6,0,0}
\definecolor{spot}{rgb}{0.6,0,0}
\definecolor{boxfill}{rgb}{.96,.97,1}
\definecolor{halfgray}{gray}{0.55}
\definecolor{webgreen}{rgb}{0,.5,0}
\definecolor{royalblue}{cmyk}{0.8, 0.50, 0, 0}

% Graffiti as in GKP's book "Concrete Mathematics"
% thanks to Lorenzo Pantieri and Enrico Gregorio
\def\graffito@setup{%
   \textmpar\footnotesize\setstretch{1}%
   \parindent=0pt \lineskip=0pt \lineskiplimit=0pt %
   \tolerance=2000 \hyphenpenalty=300 \exhyphenpenalty=300%
   \doublehyphendemerits=100000%
   \finalhyphendemerits=\doublehyphendemerits}
%\DeclareRobustCommand{\graffito}[1]{\marginpar%
% [\graffito@setup\raggedleft\hspace{0pt}{#1}]%
% {\graffito@setup\raggedright\hspace{0pt}{#1}}}
\let\oldmarginpar\marginpar
\renewcommand{\marginpar}[1]{\oldmarginpar%
 [\graffito@setup\raggedleft\hspace{0pt}{#1}]%
 {\graffito@setup\raggedright\hspace{0pt}{#1}}}

\usepackage{polyglossia}
\setmainlanguage[variant=american]{english}
\usepackage{eukdate}   % International date format - Day Month Year

\usepackage{xspace} % Helps eliminate unwanted whitespace after TeX commands
\usepackage[numbers]{natbib}
\setcitestyle{aysep={}} % No comma between author and year
\usepackage[nottoc]{tocbibind}
 
\usepackage{url}
\usepackage{listings}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{tabularx} % better tables
\usepackage{textcomp}  % additional characters
\usepackage{braket}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{graphicx}  % to include graphics
\usepackage{wrapfig}   % to get nice wrap of figures
\usepackage{placeins} % For \FloatBarrier to stop floats
\usepackage{titlesec}
\usepackage{textcase} % for \MakeTextUppercase 
\usepackage{mparhack} % get marginpar right
\usepackage{multicol}
\usepackage{xltxtra}
\usepackage{microtype}
\usepackage{setspace}
\setstretch{1.12} % Additional space between lines
\usepackage{relsize}
\usepackage[printonlyused,smaller]{acronym}
\newcommand{\acrofont}[1]{\textrm{\textmd{#1}}}
\renewcommand*{\acsfont}[1]{\textsmaller{\acrofont{#1}}}

% FONTSs & SECTION LAYOUT

\setmainfont[Scale=1.05, Mapping=tex-text, Numbers={Lining, Monospaced}]{Arno Pro}
\setmonofont[Scale=MatchLowercase]{Menlo}
\newfontfamily{\textmpar}[Mapping=tex-text, Numbers={OldStyle, Proportional}]{Arno Pro Italic SmText}
\newfontfamily{\regnum}[Mapping=tex-text, Numbers={Lining, Monospaced}]{Arno Pro}

% Must load eulervm after loading fonts
\usepackage[small]{eulervm}   % Use beautiful Euler maths (with main font number glyphs)

% Reset main font to old-style number after loading eulervm
\setmainfont[Scale=1.1, Mapping=tex-text, Numbers={OldStyle, Proportional}]{Arno Pro}


% Special characters
\newcommand{\oldamp}{\begingroup\addfontfeature{Alternate=2}\&\endgroup}

% Letterspacing
\usepackage{soul}
\sodef\allcapsspacing{\upshape}{0.15em}{0.65em}{0.6em}%
\sodef\lowsmallcapsspacing{\scshape}{0.075em}{0.5em}{0.6em}%
\DeclareRobustCommand{\spacedallcaps}[1]{\MakeTextUppercase{\allcapsspacing{#1}}}%   
\DeclareRobustCommand{\spacedlowsmallcaps}[1]{\MakeTextLowercase{\textsc{\lowsmallcapsspacing{#1}}}}%

% Table commands
\newcommand{\tableheadline}[1]{\multicolumn{1}{c}{\spacedlowsmallcaps{#1}}}

% ********************************************************************                
% headlines
% ********************************************************************
\makeatletter\@ifclassloaded{scrreprt}{%
\clearscrheadings
\setheadsepline{0pt}
\renewcommand{\sectionmark}[1]{\markright{\thesection\enspace\spacedlowsmallcaps{#1}}} 
\lehead{\mbox{\llap{\small\thepage\kern2em}\headmark\hfil}}
\rohead{\mbox{\hfil{\headmark}\rlap{\small\kern2em\thepage}}}
\renewcommand{\headfont}{\small}
}\makeatother

\makeatletter\@ifclassloaded{scrartcl}{%
  \def\toc@heading{%
    \section*{\contentsname}%
    \@mkboth{\spacedlowsmallcaps{\contentsname}}{\spacedlowsmallcaps{\contentsname}}}
}\makeatother
  
% %*********************************************************
% Sectioning
% %*********************************************************

\makeatletter\@ifclassloaded{scrartcl}{%
% Article sections \FloatBarrier
  \titleformat{\section}
    {\relax}{\large\textsc{\MakeTextLowercase{\thesection}}}{1em}{\large\spacedlowsmallcaps}
% subsections
\titleformat{\subsection}
  {\relax}{\textsc{\MakeTextLowercase{\thesubsection}}}{1em}{\normalsize\itshape}        
}\makeatother

% subsubsections
\titleformat{\subsubsection}
  {\relax}{\textsc{\MakeTextLowercase{\thesubsubsection}}}{1em}{\normalsize\itshape}        
% paragraphs
\titleformat{\paragraph}[runin]
  {\normalfont\normalsize}{\theparagraph}{0pt}{\spacedlowsmallcaps}    
% descriptionlabels
\renewcommand{\descriptionlabel}[1]{\hspace*{\labelsep}\spacedlowsmallcaps{#1}}

\titlespacing*{\section}{0pt}{1.25\baselineskip}{1\baselineskip} 
\titlespacing*{\subsection}{0pt}{1.25\baselineskip}{1\baselineskip}
\titlespacing*{\paragraph}{0pt}{1\baselineskip}{1\baselineskip}

% ********************************************************************
% footnotes setup   
% ********************************************************************
%\RequirePackage{footmisc}  % [bottom] norule para symbol* marginal perpage
    % KOMA-command, footnotemark not superscripted at the bottom
    \deffootnote{0em}{0em}{\thefootnotemark\hspace*{.5em}}      

% ********************************************************************                
% layout of the TOC, LOF and LOT (LOL-workaround see next section)
% ********************************************************************
\usepackage[titles]{tocloft}
% avoid page numbers being right-aligned in fixed-size box              
\newlength{\newnumberwidth}
\settowidth{\newnumberwidth}{999} % yields overfull hbox warnings for pages > 999
\cftsetpnumwidth{\newnumberwidth}

\newcounter{dummy} % necessary for correct hyperlinks (to index, bib, etc.)
    
% have the bib neatly positioned after the rest
\newlength{\beforebibskip}  
\setlength{\beforebibskip}{0em}
    
% space for more than nine chapters
\newlength{\newchnumberwidth}
\settowidth{\newchnumberwidth}{.} % <--- tweak here if more space required
%  \addtolength{\cftchapnumwidth}{\newchnumberwidth}%
  \addtolength{\cftsecnumwidth}{\newchnumberwidth}
  \addtolength{\cftsecindent}{\newchnumberwidth}
  \addtolength{\cftsubsecnumwidth}{\newchnumberwidth}
  \addtolength{\cftsubsecindent}{2\newchnumberwidth}
  \addtolength{\cftsubsubsecnumwidth}{\newchnumberwidth}
	  
  % % chapters
  % \renewcommand{\cftchappresnum}{\scshape\MakeTextLowercase}%
  % \renewcommand{\cftchapfont}{\scshape}%
  % \renewcommand{\cftchappagefont}{\normalfont}%
  % \renewcommand{\cftchapleader}{\hspace{1.5em}}% 
  % \renewcommand{\cftchapafterpnum}{\cftparfillskip}% 

  % sections
  \renewcommand{\cftsecpresnum}{\small\scshape\MakeTextLowercase}%
  \renewcommand{\cftsecfont}{\small\scshape\MakeTextLowercase}%
  \renewcommand{\cftsecpagefont}{\normalfont}%
  \renewcommand{\cftsecleader}{\hspace{1.5em}}% 
  \renewcommand{\cftsecafterpnum}{\cftparfillskip}%
  %\ifthenelse{\boolean{@tocaligned}}{\renewcommand{\cftsecindent}{0em}}{\relax}

  % subsections
  \renewcommand{\cftsubsecpresnum}{\scshape\MakeTextLowercase}%
  \renewcommand{\cftsubsecfont}{\normalfont}%
  \renewcommand{\cftsubsecleader}{\hspace{1.5em}}% 
  \renewcommand{\cftsubsecafterpnum}{\cftparfillskip}%   
  %\ifthenelse{\boolean{@tocaligned}}{\renewcommand{\cftsubsecindent}{0em}}{\relax}

  % subsubsections
  \renewcommand{\cftsubsubsecpresnum}{\scshape\MakeTextLowercase}%
  \renewcommand{\cftsubsubsecfont}{\normalfont}%
  \renewcommand{\cftsubsubsecleader}{\hspace{1.5em}}% 
  \renewcommand{\cftsubsubsecafterpnum}{\cftparfillskip}%   
  %\ifthenelse{\boolean{@tocaligned}}{\renewcommand{\cftsubsubsecindent}{0em}}{\relax}

  % figures     
  \renewcommand{\cftfigpresnum}{\scshape\MakeTextLowercase}% 
  \renewcommand{\cftfigfont}{\normalfont}%                 
  \renewcommand{\cftfigleader}{\hspace{1.5em}}% 
  \renewcommand{\cftfigafterpnum}{\cftparfillskip}%
  \renewcommand{\cftfigpresnum}{}% Don't prefix with 'Figure'
  \newlength{\figurelabelwidth}
  \settowidth{\figurelabelwidth}{\cftfigpresnum~9.9}
  \addtolength{\figurelabelwidth}{1.2em}
  \cftsetindents{figure}{0em}{\figurelabelwidth}
  \gappto\captionsenglish{\renewcommand{\listfigurename}{Figures}}

  % tables
  \renewcommand{\cfttabpresnum}{\scshape\MakeTextLowercase}%
  \renewcommand{\cfttabfont}{\normalfont}%
  \renewcommand{\cfttableader}{\hspace{1.5em}}% 
  \renewcommand{\cfttabafterpnum}{\cftparfillskip}%   
  \renewcommand{\cfttabpresnum}{}% Don't prefix with 'Table'
  %\newlength{\tablelabelwidth}
  %\settowidth{\tablelabelwidth}{\cfttabpresnum~99}
  %\addtolength{\tablelabelwidth}{2.5em}
  % \cftsetindents{table}{0em}{\tablelabelwidth}
  \cftsetindents{table}{0em}{\figurelabelwidth}
%  \gappto\captionsenglish{\renewcommand{\tablename}{Definition}}
%  \gappto\captionsenglish{\renewcommand{\listtablename}{Definitions}}

  % listings
  \newlistof{listings}{lol}{\lstlistlistingname}%
  \renewcommand{\cftlistingspresnum}{\scshape\MakeTextLowercase}%
  \renewcommand{\cftlistingsfont}{\normalfont}%
  \renewcommand{\cftlistingspresnum}{}% Don't prefix with 'Listing'
  \renewcommand{\cftlistingspagefont}{\normalfont}%
  \renewcommand{\cftlistingsleader}{\hspace{1.5em}}%
  \renewcommand{\cftlistingsafterpnum}{\cftparfillskip}%
  %\newlength{\listingslabelwidth}%
  %\settowidth{\listingslabelwidth}{\cftlistingspresnum~99}%
  %\addtolength{\listingslabelwidth}{}%
  % \cftsetindents{listings}{0em}{\listingslabelwidth}%
  \cftsetindents{listings}{0em}{\figurelabelwidth}
  \makeatletter%
  \let\l@lstlisting\l@listings%
  \let\lstlistoflistings\listoflistings%
  \makeatother
  % \renewcommand\lstlistingname{Example}
  % \renewcommand\lstlistlistingname{Examples}
  % \def\lstlistingautorefname{Example}

  % dirty work-around to get the spacing after the toc/lot/lof-titles right    
  \AtBeginDocument{\addtocontents{toc}{\protect\vspace{-1em}}}

  \newcommand{\tocEntry}[1]{% for bib, etc.
    \spacedlowsmallcaps{#1}
  }

% %    % remove the vertical space between lof/lot entries of different chapters
% 		\ifthenelse{\boolean{@listsseparated}}{%
% 		 \PackageWarningNoLine{classicthesis}{Option "listsseparated" deprecated as of version 2.9.}%
% 		}{\relax}
% %    \ifthenelse{\boolean{@listsseparated}}{%
% %        \AtBeginDocument{%
% %            \addtocontents{lof}{\protect\vspace{-\cftbeforechapskip}}%
% %            \addtocontents{lot}{\protect\vspace{-\cftbeforechapskip}}%
% %            \ifthenelse{\boolean{@listings}}%        
% %    				{%
% %             	\addtocontents{lol}{\protect\vspace{-\cftbeforechapskip}}%
% %            }{\relax}%
% %        }%
% %    }{%
%         \DeclareRobustCommand*{\deactivateaddvspace}{\let\addvspace\@gobble}% 
%         \AtBeginDocument{%      
%             \addtocontents{lof}{\deactivateaddvspace}% 
%             \addtocontents{lot}{\deactivateaddvspace}%
%     				\ifthenelse{\boolean{@listings}}% 
%     				{%
%              	\addtocontents{lol}{\deactivateaddvspace}%
%             }{\relax}%                  
%         }%
% %    } 
   
% ********************************************************************
% Hyperreferences setup
%*******************************************************
\usepackage{hyperref}
\hypersetup{%
    colorlinks=true, linktocpage=true, pdfstartpage=3, pdfstartview=FitV,%
    % uncomment the following line if you want to have black links (e.g., for printing)
    %colorlinks=false, linktocpage=false, pdfborder={0 0 0}, pdfstartpage=3, pdfstartview=FitV,% 
    breaklinks=true, pdfpagemode=UseNone, pageanchor=true, pdfpagemode=UseOutlines,%
    plainpages=false, bookmarksnumbered, bookmarksopen=true, bookmarksopenlevel=1,%
    hypertexnames=true, pdfhighlight=/O,%hyperfootnotes=true,%nesting=true,%frenchlinks,%
    urlcolor=RoyalBlue, linkcolor=spot, citecolor=spot, %pagecolor=RoyalBlue,%
    %urlcolor=Black, linkcolor=Black, citecolor=Black, %pagecolor=Black,%
    pdftitle={Advanced Programming 2013 Exam Report},%the title
    pdfauthor={Rasmus Borgsmidt},%your name
    pdfsubject={},%
    pdfkeywords={},%
    pdfcreator={XeLaTeX},%
    pdfproducer={XeLaTeX}%
}

% ******************************************************
% Listings setup
%*******************************************************
\lstset{
  basicstyle=\ttfamily\small,
  commentstyle=\color{webgreen}\ttfamily,
  numbers=left,
  numberstyle=\ttfamily\scriptsize,
  numbersep=8pt,
  showstringspaces=false,
  breaklines=true,
  backgroundcolor=\color{boxfill},
  frame=tb,
  framerule=\heavyrulewidth, % defined in the booktabs package
  belowcaptionskip=.75\baselineskip
}

% Get single spacing in listings
\let\oldlst\lstlisting
\def\lstlisting{\par\setstretch{0.8}\oldlst}
\let\oldlstin\lstinputlisting
\def\lstinputlisting{\par\setstretch{0.8}\oldlstin}

% Use regular - instead of dash in listings
\makeatletter
\lst@CCPutMacro\lst@ProcessOther {"2D}{\lst@ttfamily{-{}}{-{}}}
\@empty\z@\@empty
\makeatother


% Disable single lines at the start of a paragraph (Schusterjungen)
\clubpenalty = 10000
% Disable single lines at the end of a paragraph (Hurenkinder)
\widowpenalty = 10000 
\displaywidowpenalty = 10000 % formulas


\begin{document}

\title{\textcolor{spot}{\rmfamily\mdseries\spacedlowsmallcaps{Exam Report}}}
\subtitle{\rmfamily\mdseries\itshape\normalsize{Advanced Programming 2013}}
\author{\large Rasmus Borgsmidt}
\date{}
\vspace{-30pt}\maketitle
\pdfbookmark[1]{\contentsname}{tableofcontents}
\setcounter{tocdepth}{2} % <-- 2 includes up to subsections in the ToC
\manualmark
\vspace{-30pt}\tableofcontents
%\vspace{30pt}

\addcontentsline{toc}{section}{\lstlistlistingname}
\lstlistoflistings

%\addcontentsline{toc}{section}{Tables}
\listoftables

\fontdimen2\font=1.25\fontdimen2\font% interword space
\fontdimen3\font=1.25\fontdimen3\font% interword stretch
\fontdimen4\font=\fontdimen4\font% interword shrink

\clearpage
\section*{Introduction}
\addcontentsline{toc}{section}{Introduction}

This report is part of an answer to the take-home exam of the course {\em
  Advanced Programming 2013} held at University of Copenhagen, Department of
Computer Science (\textsmaller{DIKU}).

The intended reader is expected to have knowledge of general computer
science topics equivalent to a third-year undergraduate student; and in addition
to have followed this course.

The answer to this exam is submitted electronically, and this report is
submitted alongside a file archive called {\tt src.zip}; the contents of this
archive is specified in listing \ref{lst:filetree}.

\section{Q1: Salsa Language Parser}

In this question, we are asked to implement a parser of the {\scshape Salsa}
source language, constructing an \ac{AST} in accordance with the data types
specified in listing \ref{lst:ast}. The parser must be constructed using one of
three available parser libraries, and I have chosen to use {\tt SimpleParse}
because it is simple and does what we need (listing \ref{lst:sp}).

All the relevant code and test files are included in appendix
\ref{sec:question-1-code}.

\subsection{Grammar Transformations}

The supplied grammar is both ambiguous and left-recursive. But for this
grammar\footnote{Not every grammar has an equivalent \acs{LL1} grammar} it is
possible to construct an equivalent \acs{LL1} grammar using the techniques
outlined by \citet[p.~69]{mogensen2011}:
\begin{enumerate}
\item Eliminate ambiguity
\item Eliminate left-recursion
\item Perform left-factorization where required
\end{enumerate}
There is a number of benefits in doing this. First and foremost, an \acs{LL1}
grammar makes it a near-mechanical process to construct a parser using {\tt
  SimpleParse} and this makes it a good choice for emphasizing correctness. The
parser can be improved for brevity and efficiency later, fx.\ using constructs
like {\tt many1} and by combining several of the smaller parsers to minimize
code repetition. Secondly as can be seen from table \ref{grammar}, the resulting
grammar makes it explicit that {\tt '@'} has higher precedence than {\tt
  '||'}. In other words, it makes it impossible to derive the wrong parse tree
from a given input.

As an aside on left-factorization, {\em where required} in item 3 above alludes
to the fact that it is only necessary to change the grammar in this respect
where {\em a single nonterminal} has several productions beginning with the same
sequence of symbols. It is therefore not a problem that both {\em Pos} and {\em
  Prim} have a production beginning with {\tt '('}.

The associativity of {\tt '||'} was not specified by the original grammar, but I
have chosen it to be left-associative since that seems most logical and is
symmetric to the associativity of {\tt '@'}. The associavity of {\tt '||'} has
no impact on the generated output anyway. {\tt '+'} and {\tt '-'} are assumed to
have equal precedence.

The constructed parser in {\tt SalsaParser.hs} is shown in listing \ref{lst:sp}.
\begin{table}[h]
  \centering\regnum
  \caption{{\regnum LL(1)} {\scshape Salsa} Grammar}\label{grammar}
  \begin{tabularx}{\textwidth}{rcX} \toprule
    {\em Program}    & $::=$ & {\em DefComs}\\
    {\em DefComs}    & $::=$ & {\em DefCom} {\em DefComs$_{*}$}\\
    {\em DefComs$_{*}$}   & $::=$ & {\em DefCom} {\em DefComs$_{*}$}\\
               & $|$   & $\epsilon$\\
    {\em DefCom}     & $::=$ & {\em Command}\\
               & $|$   & {\em Definition}\\
    {\em Definition} & $::=$ & {\tt 'viewdef'} {\em VIdent} {\em Expr} {\em Expr}\\
               & $|$   & {\tt 'rectangle'} {\em SIdent} {\em Expr} {\em Expr} {\em Expr} {\em Expr} {\em Colour}\\
               & $|$   & {\tt 'circle'} {\em SIdent} {\em Expr} {\em Expr} {\em Expr} {\em Colour}\\
               & $|$   & {\tt 'view'} {\em VIdent}\\
               & $|$   & {\tt 'group'} {\em VIdent} {\tt '['} {\em VIdents} {\tt ']'}\\
    {\em Command}    & $::=$ & {\em Command1} {\em Command$_{*}$}\\
    {\em Command$_{*}$}    & $::=$ & {\tt '||'} {\em Command1} {\em Command$_{*}$}\\
               & $|$ & $\epsilon$ \\
    {\em Command1}    & $::=$ & {\em Command2} {\em Command1$_{*}$}\\
    {\em Command1$_{*}$}    & $::=$ & {\tt '@'} {\em VIdent} {\em Command1$_{*}$}\\
               & $|$ & $\epsilon$ \\
    {\em Command2}    & $::=$ & {\em SIdents} {\tt '->'} {\em Pos}\\
               & $|$   & {\tt '\{'} {\em Command} {\tt '\}'}\\

    {\em VIdents}    & $::=$ & {\em VIdent} {\em VIdents$_{*}$}\\
    {\em VIdents$_{*}$}    & $::=$ & {\em VIdent} {\em VIdents$_{*}$}\\
               & $|$   & $\epsilon$\\
    {\em SIdents}    & $::=$ & {\em SIdent} {\em SIdents$_{*}$}\\
    {\em SIdents$_{*}$}    & $::=$ & {\em SIdent} {\em SIdents$_{*}$}\\
               & $|$   & $\epsilon$\\
    {\em Pos}        & $::=$ & {\tt '('} {\em Expr} {\tt ','} {\em Expr} {\tt ')'}\\
               & $|$   & {\tt '+'} {\tt '('} {\em Expr} {\tt ','} {\em Expr} {\tt ')'}\\
    {\em Expr}       & $::=$ & {\em Prim} {\em Expr$_{*}$}\\
    {\em Expr$_{*}$}       & $::=$ & {\tt '+'} {\em Prim} {\em Expr$_{*}$}\\
               & $|$   & {\tt '-'} {\em Prim} {\em Expr$_{*}$}\\
               & $|$   & $\epsilon$\\
    {\em Prim}       & $::=$ & {\em integer}\\
               & $|$   & {\em SIdent} {\tt '.'} {\em Coord}\\
               & $|$   & {\tt '('} {\em Expr} {\tt ')'}\\
    {\em Coord}       & $::=$ & {\tt 'x'} $|$ {\tt 'y'}\\
    {\em Colour}     & $::=$ & {\tt 'blue'} $|$ {\tt 'plum'} $|$ {\tt 'red'} $|$ {\tt 'green'} $|$ {\tt 'orange'}\\
    \bottomrule
  \end{tabularx}
\end{table}

\subsection{Testing}
\label{sec:testing}

I wanted to come up with a set of {\em automated tests}\footnote{automated test:
  test that breaks automatically if there is a problem and requires no manual
  supervision} that exercise the various parts of the grammar separately without
having to expose additional functions from the module. The resulting test suite
is shown in listing \ref{lst:spt} and the session output is shown in listing
\ref{lst:testoutparser}.

\subsection{Assessment}
\label{sec:assessment}

I believe this is a complete and correct solution to question 1, and I have a
high degree of confidence in the code. I base this assessment on the fact that
I was able to obtain an equivalent \acs{LL1} grammar, which makes it
straightforward to construct a parser, and that I have a reliable test suite to
exercise the parser.

Furthermore, {\tt ghc -Wall} compiles the code without any warnings.

\clearpage
\section{Q2: Salsa Language Interpreter}

In this question, we are asked to construct an interpreter that from an \ac{AST}
generated by the parser constructed in question 1, generates an {\tt Animation}
in accordance with the data types specified in listing \ref{lst:gpx}. The
implementation is shown in listing \ref{lst:si} and the definitions mentioned in
this section are defined there. All the relevant code and test files are
included in appendix \ref{sec:question-2-code}.


A {\tt Context} comprises an environment and state information; the environment
specifies views, shapes and other definitions, the state specifies the position
of each shape on the views as well as the graphics instructions generated so far
by by interpreter. It is an explicit requirement that our {\tt StateCommand}
monad reflect that a command can modify only the state information, not the
environment, so I have chosen these definitions:
\begin{lstlisting}
newtype SalsaCommand a = SalsaCommand { runSC :: Context -> (a, State) }
newtype Salsa a = Salsa { runSalsa :: Context -> (a, Context) }
\end{lstlisting}
The {\tt SalsaCommand} type captures the effect of running a command in a given
context, that is moving from the current key frame to the next and generating
all the intermediate frames that goes with it.

The {\tt Salsa} type represents an animation step; it is either a definition that
changes the environment somehow, perhaps by modifying the current key frame, or
it is a new command that causes a move to a new keyframe. To encapsulate a {\tt
  SalsaCommand} as a {\tt Salsa} computation, we use the following function:
\begin{lstlisting}
liftC :: SalsaCommand a -> Salsa a
liftC sc = Salsa $ \context -> let (x, st) = runSC sc context
                               in (x, context { state = st })
\end{lstlisting}%$

\subsection{Frame Sets}
\label{sec:frame-sets}

To generate the frames as each command moves the animation from one context to
the next, my implementation keeps track of {\em frame sets}; a frame set is the
set of frames between one key frame and the next. A blank context starts out
with a single frame in a single frame set, representing the initial key
frame. With each command a new frame set is added, and when every {\tt Salsa}
computation has been applied, the final {\tt Animation} is constructed by
flattening the frame sets to a list of frames.

because {\tt Definitions} frequently need to manipulate the current key frame,
the frame sets are stored in reverse order so the current one is at the head of
the list. Likewise the frames inside a single frame set are stored in reverse
order, so the key frame is at the head. With a framerate of $n$, after $m$
commands we have the following frame set structure where the $k$ are key frames
and $f$ are intermediate frames:
\[
[[k_{mn},\ldots,f_{m1}], \ldots, [k_{1n},\ldots,f_{11}], [k_0]]
\]

\subsection{Parallel Commands}

To achieve the effect of running two commands in parallel, the interpreter first
runs both commands as normal; then it merges the two most recent frame sets so
that the generated graphics instructions occur in the same frame set. This is in
fact the reason to use distinct frame sets at all; so they can be combined after
the fact.

In order to do this reliably, the interpreter needs to keep track of which
shapes caused the generation of which instructions. Therefore the interpreter is
working with what I have called extended frames:
\begin{lstlisting}
type ExtFrame = [(Ident, GpxInstr)]
\end{lstlisting}
This additional information is used to ensure we keep the right information from
each of the merged frame sets.

\subsection{Testing}
\label{sec:testing-1}

For this question, I have resorted to manual testing by running the interpreter
on input in GHCi. Sample output of this testing is show in listing
\ref{lst:testoutinterp}. I have also found it helpful to verify the behavior of
the interpreter by pasting generated output into the viewer supplied here:
\url{http://www.diku.dk/~kflarsen/ap-e2013/gpx.html}.

\subsection{Assessment}
\label{sec:assessment-1}

Although I have only conducted manual testing, I have been quite thorough so I
have a reasonable confidence in the implementation. Furthermore, {\tt ghc -Wall}
compiles the code without any warnings. I believe this answer to be complete and
correct.

However, given the stated objective of the question; ``using monads for
structuring your code,'' I wonder if there are other areas of the implementation
where monads should or could have been used as well. I considered briefly
creating an evaluation executor monad for the expression evaluation, but the
function {\tt eval :: Context -> Expr -> Integer} is so simple that it was
unnecessary.

As an aside, I noticed that the target language has no means of tracking when
views come into existence. If a view is defined later in the animation, the
resulting instructions do not reflect this; the view is created immediately but
stay blank until something happens on them.

\clearpage
\section{Q3: Atomic Transaction Server}

In this question, we are asked to build an atomic transaction server. I have
chosen to use the OTP behavior {\tt gen\_server} because it provides a nice
well-structured framework for the code. All the relevant code and test files are
included in appendix \ref{sec:question-3-code}.


My implementation is structured as two separate {\tt gen\_server} instances; {\tt
  at\_server} shown in listing \ref{lst:ats} and {\tt at\_trans} shown in listing
\ref{lst:att}. This ensures a good separation of concerns. The {\tt at\_server}
implements the AT server itself, whereas the {\tt at\_trans} implements the
transaction processes that do much of the work for the server.

\subsection{Timeouts}

I considered using timeouts to protect the implementation from stalling
functions, but there is really no way for the AT server implementation to
determine what a ``reasonable'' timeout is. So I have chosen a middleground,
where the {\tt doquery} call directly to the server employs a timeout. This is
the most critical call because if that hangs, the whole server is down!

For the other queries and updates, if the client wants to use a timeout this
can be implemented inside the functions passed to the AT server.

\subsection{Responding to Clients}
\label{sec:responding-clients}

The {\tt update\_t} call always returns {\tt ok} immediately so this has been
implemented using {\tt handle\_cast}.

The {\tt query\_t} call is handled using {\tt handle\_call} because the client is
blocked waiting for a response, but the server passes off the request to the
relevant transaction process and finishes the {\tt handle\_call} without replying
to the client. Later when the transaction process has finished, it notifies the
AT server using an out-of-band message with reason {\tt \{TPid,
  \{query\_succeeded, Result, Client\}\}} or {\tt \{TPid, \{query\_failed,
  Client\}\}} and the server responds appropriately to the client.

The {\tt commit\_t} call is also handled using {\tt handle\_call} but for this,
the server blocks and responds to the client before exiting {\tt
  handle\_call}. This is of course to ensure that only one {\tt commit\_t} be
accepted at a time.

When the transaction has been committed, the server kills all remaining
transaction processes and immediately replies to all clients waiting for a
reply. This is handled by a {\em waiting queue} that a client's pid is added to
when calling into {\tt query\_t}. Using this waiting list is safe because the
client is blocked when waiting for a reply, and can therefore only ever have one
reply outstanding from the server.

\subsection{Extended API}
\label{sec:extended-api}

I have implemented the extended API as requested and the code can be found in
listing \ref{lst:ate}. The most interesting function is {\tt choiceUpdate}
towards the end which spawns a separate process for each value in the supplied
list. It then proceeds to wait for responses from the processes and ensures that
it gets {\tt ok} from exactly one process and {\tt aborted} from the rest.

My interpretation of the exam text: ``[...] the result of choiceUpdate is the
result of this commit'' is that {\tt choiceUpdate} should return the resulting
state that was actually committed to the server. In order to achieve this, each
worker process reads back the result of applying the supplied function to the
state in the transaction prior to attempting a commit. This is the only way to
be sure that the correct result is returned. If {\tt choiceUpdate} instead read
the state from the server after the commit, it could easily have changed again
in the meantime.

There is an interesting theoretical problem with {\tt choiceUpdate} that I was
not sure how to handle; If the supplied list is so long, that the process
calling choiceUpdate is still busy spawning new processes when the first process
has already finished and committed its result, then it is possible for later
processes to go through a clean {\tt begin\_t/update\_t/commit\_t} cycle as
well. Revisiting the problem now, I think a potential solution might be to
create all the processes up-front and let them begin a transaction with {\tt
  begin\_t}. Only then should {\tt choiceUpdate} kick off the rest of the cycle
with some kind of multicast message to every worker process at once.

\subsection{Testing}
\label{sec:testing-2}

I have used EUnit for testing this implementation and the resulting automated
test scripts can be found in listings \ref{lst:atst} and \ref{lst:atet}. Output
from running these can be found in listings \ref{lst:testoutserver} and
\ref{lst:testoutextapi}. Output from a particularly interesting test can be
found in listing \ref{lst:testoutcommit}, where $100$ distinct processes all try
to commit a transaction simultaneously. The output demonstrates how one of these
was committed successfully while the $99$ others were correctly aborted.

\subsection{Assessment}
\label{sec:assessment-2}

I believe this is a complete and correct solution to question 3 and I have a
very high degree of confidence in the implementation. I base this assessment on
the fact that I have used a tried-and-true framework for structuring the code,
that the implementation uses separate {\tt gen\_server} instances to ensure
separation of concerns, and that I have built a reasonably comprehensive
automated test suite where all the tests show that the implementation works.

\bibliographystyle{plainnat}
\bibliography{borgsmidt-report}

\addcontentsline{toc}{section}{Acronyms}
\section*{Acronyms}
\begin{acronym}[DRY]
  \acro{AST}[\acrofont{AST}]{Abstract Syntax Tree}
  \acro{LL1}[\acrofont{{\regnum LL(1)}}]{Left-to-Right, Left-order, $1$-symbol Look-ahead}
\end{acronym}

\appendix

\newcommand{\shcodefile}[2]{%
\lstinputlisting[basicstyle=\ttfamily\footnotesize, language={},%
  caption={\tt #1}, label=lst:#2]{../#1}}

\clearpage
\section{Q1 Code Files}
\label{sec:question-1-code}

\subsection{Source Code}
\label{sec:source-code}

\shcodefile{src/salsa/SalsaParser.hs}{sphs}

\subsection{Test Code}
\label{sec:test-code}

\shcodefile{src/salsa/SalsaParserTest.hs}{spt}

\subsection{Test Output}
\label{sec:test-output}

\begin{lstlisting}[caption=Session output: {\tt src/salsa/SalsaParserTest}, label=lst:testoutparser]
*** Checking Colour ***
pass: circle c 0 0 0 blue
pass: circle c 0 0 0 plum
pass: circle c 0 0 0 red
pass: circle c 0 0 0 green
pass: circle c 0 0 0 orange
error (expected): circle c 0 0 0 violet
error (expected): circle c 0 0 0 greeen
error (expected): circle c 0 0 0 Blue
error (expected): circle c 0 0 0 blue1

*** Checking Prim ***
pass: a -> (0, 0)
pass: a -> (42, 42)
pass: a -> (999999999, 999999999)
pass: a -> ((((42))), (((42))))
pass: a -> (john . x, john . x)
pass: a -> (john . y, john . y)
error (expected): a -> (-5, -5)
error (expected): a -> (-5, -5)
error (expected): a -> (42.2, 42.2)
error (expected): a -> (.8, .8)

*** Checking Expr ***
pass: a -> (1 + 2, 1 + 2)
pass: a -> (1 - 2, 1 - 2)
pass: a -> (1 + 2 + 3, 1 + 2 + 3)
pass: a -> (1 - 2 - 3, 1 - 2 - 3)
pass: a -> (1 + 2 - 3, 1 + 2 - 3)
pass: a -> (1 - 2 + 3, 1 - 2 + 3)

*** Checking Pos ***
pass: a -> (0, 0)
pass: a -> + (0, 0)

*** Checking SIdents ***
pass: a -> (0, 0)
pass: aBC -> (0, 0)
pass: a12T -> (0, 0)
pass: aa bb cc -> (0, 0)
error (expected): 1abc -> (0, 0)
error (expected): Abc -> (0, 0)
error (expected): _abc -> (0, 0)
error (expected): _ -> (0, 0)
error (expected): viewdef -> (0, 0)
error (expected): rectangle -> (0, 0)
error (expected): circle -> (0, 0)
error (expected): view -> (0, 0)
error (expected): group -> (0, 0)
error (expected): blue -> (0, 0)
error (expected): plum -> (0, 0)
error (expected): red -> (0, 0)
error (expected): green -> (0, 0)
error (expected): orange -> (0, 0)

*** Checking VIdents ***
pass: group V [A]
pass: group V [Abc]
pass: group V [A12t]
pass: group V [AA BB CC]
error (expected): group V [1Abc]
error (expected): group V [aBC]
error (expected): group V [_ABC]
error (expected): group V [_]

*** Checking Command ***
pass: a->(0, 0)
pass: a->(0, 0)@V
pass: a->(0, 0)@V@W
pass: a->(0, 0)||b->(0, 0)
pass: a->(0, 0)||b->(0, 0)||c->(0,0)
pass: a->(0, 0)||b->(0, 0)@V
pass: {a->(0, 0)||b->(0, 0)}@V
pass: {{{a->(0, 0)}}}

*** Checking Definition ***
pass: viewdef V 0 0
pass: rectangle r 0 0 0 0 blue
pass: circle c 0 0 0 blue
pass: view V
pass: group G [X Y Z]
error (expected): view1 V

*** Checking Program ***
error (expected): <empty string>
pass: viewdef Default 400 400
rectangle box 10 400 20 20 green
box -> (10, 200)
box -> +(100, 0)
box -> (110,400)
box -> +(0-100, 0)

pass: viewdef One 500 500
viewdef Two 400 400
group Both [One Two]
view Both
rectangle larry 10 350 20 20 blue
rectangle fawn 300 350 15 25 plum

view Two
larry -> (300, 350) || fawn -> (10,350)

view Both
larry fawn -> +(0, 0 - 300)

*** Checking parseFile ***
pass: viewdef One 500 500
viewdef Two 400 400
group Both [One Two]
view Both
rectangle larry 10 350 20 20 blue
rectangle fawn 300 350 15 25 plum

view Two
larry -> (300, 350) || fawn -> (10,350)

view Both
larry fawn -> +(0, 0 - 300)

*** All tests completed successfully ***
\end{lstlisting}


\subsection{Used Hand-outs}
\label{sec:hand-outs-used}

\shcodefile{src/salsa/SalsaAst.hs}{ast}
\shcodefile{src/salsa/SimpleParse.hs}{sp}

\subsection{Sample Files}
\label{sec:sample-files}

\shcodefile{src/salsa/simple.salsa}{simple}

\shcodefile{src/salsa/multi.salsa}{multi}


\clearpage
\section{Q2 Code Files}
\label{sec:question-2-code}

\subsection{Source Code}
\label{sec:source-2-code}

\shcodefile{src/salsa/SalsaInterp.hs}{si}

\subsection{Test Output}
\label{sec:test-2-output}

\begin{lstlisting}[caption=Test output for manual interpreter testing (pretty printed), label=lst:testoutinterp]
--
-- Interpolate tests
--

   interpolate 1 (0,0) (100,100)
=> [(100,100)]

   interpolate 2 (0,0) (100,100)
=> [(50,50),(100,100)]

   interpolate 5 (0,0) (100,100)
=> [(20,20),(40,40),(60,60),(80,80),(100,100)]


--
-- Testing empty input
--

   runProg 1 []
=> ([],[[]])

   runProg 10 []
=> ([],[[]])


--
-- Testing generation of key frames by using framerate 1
--

   runProg 1 [ Def (Viewdef "Default" (Const 400) (Const 400)),
               Def (Rectangle "box" (Const 10) (Const 400) (Const 20)
                       (Const 20) Green),
               Com (Move ["box"] (Abs (Const 10) (Const 200))),
               Com (Move ["box"] (Rel (Const 100) (Const 0))),
               Com (Move ["box"] (Abs (Const 110) (Const 400))),
               Com (Move ["box"] (Rel (Minus (Const 0) (Const 100)) (Const 0))) ]
=> ([("Default",400,400)],
    [[DrawRect 10 400 20 20 "Default" "green"],
     [DrawRect 10 200 20 20 "Default" "green"],
     [DrawRect 110 200 20 20 "Default" "green"],
     [DrawRect 110 400 20 20 "Default" "green"],
     [DrawRect 10 400 20 20 "Default" "green"]])

   runProg 1 [ Def (Viewdef "One" (Const 500) (Const 500)),
               Def (Viewdef "Two" (Const 400) (Const 400)),
               Def (Group "Both" ["One","Two"]),
               Def (View "Both"),
               Def (Rectangle "larry" (Const 10) (Const 350) (Const 20)
                       (Const 20) Blue),
               Def (Rectangle "fawn" (Const 300) (Const 350) (Const 15)
                       (Const 25) Plum),
               Def (View "Two") ,
               Com (Par (Move ["larry"] (Abs (Const 300) (Const 350)))
                       (Move ["fawn"] (Abs (Const 10) (Const 350)))),
               Def (View "Both"),
               Com (Move ["larry","fawn"]
                       (Rel (Const 0) (Minus (Const 0) (Const 300)))) ]
=> ([("One",500,500),("Two",400,400)],
    [[DrawRect 300 350 15 25 "One" "plum",
      DrawRect 300 350 15 25 "Two" "plum",
      DrawRect 10 350 20 20 "One" "blue",
      DrawRect 10 350 20 20 "Two" "blue"],

     [DrawRect 10 350 15 25 "Two" "plum",
      DrawRect 300 350 15 25 "One" "plum",
      DrawRect 300 350 20 20 "Two" "blue",
      DrawRect 10 350 20 20 "One" "blue"],

     [DrawRect 300 50 20 20 "Two" "blue",
      DrawRect 10 50 20 20 "One" "blue",
      DrawRect 10 50 15 25 "Two" "plum",
      DrawRect 300 50 15 25 "One" "plum"]])


--
-- Testing full operation with a higher framerate that requires intermediate
-- frames (highlighted with extra indentation)
--

   runProg 3 [ Def (Viewdef "One" (Const 500) (Const 500)),
               Def (Viewdef "Two" (Const 400) (Const 400)),
               Def (Group "Both" ["One","Two"]),
               Def (View "Both"),
               Def (Rectangle "larry" (Const 10) (Const 350) (Const 20)
                       (Const 20) Blue),
               Def (Rectangle "fawn" (Const 300) (Const 350) (Const 15)
                       (Const 25) Plum),
               Def (View "Two") ,
               Com (Par (Move ["larry"] (Abs (Const 300) (Const 350)))
                        (Move ["fawn"] (Abs (Const 10) (Const 350)))),
               Def (View "Both"),
               Com (Move ["larry","fawn"]
                       (Rel (Const 0) (Minus (Const 0) (Const 300)))) ]
=> ([("One",500,500),("Two",400,400)],
    [[DrawRect 300 350 15 25 "One" "plum",
      DrawRect 300 350 15 25 "Two" "plum",
      DrawRect 10 350 20 20 "One" "blue",
      DrawRect 10 350 20 20 "Two" "blue"],

         [DrawRect 203 350 15 25 "Two" "plum",
          DrawRect 300 350 15 25 "One" "plum",
          DrawRect 107 350 20 20 "Two" "blue",
          DrawRect 10 350 20 20 "One" "blue"],

         [DrawRect 107 350 15 25 "Two" "plum",
          DrawRect 300 350 15 25 "One" "plum",
          DrawRect 203 350 20 20 "Two" "blue",
          DrawRect 10 350 20 20 "One" "blue"],

     [DrawRect 10 350 15 25 "Two" "plum",
      DrawRect 300 350 15 25 "One" "plum",
      DrawRect 300 350 20 20 "Two" "blue",
      DrawRect 10 350 20 20 "One" "blue"],

         [DrawRect 300 250 20 20 "Two" "blue",
          DrawRect 10 250 20 20 "One" "blue",
          DrawRect 10 250 15 25 "Two" "plum",
          DrawRect 300 250 15 25 "One" "plum"],

         [DrawRect 300 150 20 20 "Two" "blue",
          DrawRect 10 150 20 20 "One" "blue",
          DrawRect 10 150 15 25 "Two" "plum",
          DrawRect 300 150 15 25 "One" "plum"],

     [DrawRect 300 50 20 20 "Two" "blue",
      DrawRect 10 50 20 20 "One" "blue",
      DrawRect 10 50 15 25 "Two" "plum",
      DrawRect 300 50 15 25 "One" "plum"]])
\end{lstlisting}

\subsection{Used Hand-outs}
\label{sec:hand-outs-2-used}

The source language of the interpreter is the same as the target language of the
parser and is specified in listing \ref{lst:ast}. The target language of the
interpreter is specified in listing \ref{lst:gpx} below.

\shcodefile{src/salsa/Gpx.hs}{gpx}

\clearpage
\section{Q3 Code Files}
\label{sec:question-3-code}

\subsection{Source Code}
\label{sec:source-3-code}

\lstinputlisting[basicstyle=\ttfamily\footnotesize, language={},%
  caption={\tt src/at\_server/at\_server.erl}, label=lst:ats]{../src/at_server/at_server.erl}

\lstinputlisting[basicstyle=\ttfamily\footnotesize, language={},%
  caption={\tt src/at\_server/at\_trans.erl}, label=lst:att]{../src/at_server/at_trans.erl}

\lstinputlisting[basicstyle=\ttfamily\footnotesize, language={},%
  caption={\tt src/at\_server/at\_extapi.erl}, label=lst:ate]{../src/at_server/at_extapi.erl}

\subsection{Test Code}
\label{sec:test-3-code}

\lstinputlisting[basicstyle=\ttfamily\footnotesize, language={},%
  caption={\tt src/at\_server/at\_server\_tests.erl}, label=lst:atst]{../src/at_server/at_server_tests.erl}

\lstinputlisting[basicstyle=\ttfamily\footnotesize, language={},%
  caption={\tt src/at\_server/at\_extapi\_tests.erl}, label=lst:atet]{../src/at_server/at_extapi_tests.erl}

\subsection{Test Output}
\label{sec:test-3-output}

\begin{lstlisting}[caption=Session output: {\tt src/at\_server/at\_server\_tests.erl}, label=lst:testoutserver]
> eunit:test(at_server, [verbose]).
======================== EUnit ========================
module 'at_server'
  module 'at_server_tests'
    at_server_tests: commit_t_competing_test...[0.007 s] ok
    at_server_tests: commit_t_abort_longrunning_test...[0.051 s] ok
    at_server_tests: commit_t_success_test...ok
    at_server_tests: update_t_failure_test...ok
    at_server_tests: update_t_success_test...ok
    at_server_tests: query_t_failure_test...ok
    at_server_tests: begin_t_test...ok
    at_server_tests: query_t_success_test...ok
    at_server_tests: doquery_failure_test...ok
    at_server_tests: doquery_success_test...ok
    [done in 0.087 s]
  [done in 0.087 s]
=======================================================
  All 10 tests passed.
ok
\end{lstlisting}

\begin{lstlisting}[caption=Session output: {\tt src/at\_server/at\_extapi\_tests.erl}, label=lst:testoutextapi]
> eunit:test(at_extapi, [verbose]).
======================== EUnit ========================
module 'at_extapi'
  module 'at_extapi_tests'
    at_extapi_tests: choice_update_test...[0.001 s] ok
    at_extapi_tests: ensure_update_ok_test...ok
    at_extapi_tests: ensure_update_retry_test...[0.202 s] ok
    at_extapi_tests: ensure_update_error_test...ok
    at_extapi_tests: try_update_error_test...ok
    at_extapi_tests: try_update_aborted_test...[0.101 s] ok
    at_extapi_tests: try_update_ok_test...[0.001 s] ok
    at_extapi_tests: abort_test...ok
    [done in 0.328 s]
  [done in 0.328 s]
=======================================================
  All 8 tests passed.
ok
\end{lstlisting}

\begin{lstlisting}[caption=Session output: {\tt
    commit\_t\_competing\_test()} (debug enabled),
  label=lst:testoutcommit, basicstyle=\ttfamily\scriptsize]
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31695> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31699> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31704> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31714> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31719> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31723> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31728> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31732> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31736> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31740> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31744> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31748> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31758> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31762> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31768> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31772> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31776> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31780> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31784> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31788> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31790> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31792> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31794> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31796> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31800> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31806> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31810> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31814> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31818> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31822> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31826> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31830> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31832> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31834> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31836> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31840> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31844> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31848> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31852> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31856> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31860> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31864> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31868> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31872> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31874> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31876> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31878> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31882> aborted
at_server_tests.erl:154:<0.3764.0>: ----> Transaction #Ref<0.0.0.31680> committed
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31682> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31684> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31686> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31688> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31691> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31693> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31697> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31701> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31706> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31708> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31710> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31712> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31717> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31721> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31725> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31730> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31734> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31738> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31742> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31746> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31750> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31752> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31754> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31756> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31760> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31764> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31766> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31770> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31774> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31778> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31782> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31786> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31798> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31802> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31804> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31808> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31812> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31816> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31820> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31824> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31828> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31838> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31842> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31846> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31850> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31854> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31858> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31862> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31866> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31870> aborted
at_server_tests.erl:151:<0.3764.0>: Transaction #Ref<0.0.0.31880> aborted
\end{lstlisting}

\clearpage
\section{Submitted File Tree}
\label{sec:submitted-files}

\begin{lstlisting}[caption=File tree under {\tt src/}, label=lst:filetree]
src/
|-- at_server
|   |-- at_extapi.erl
|   |-- at_extapi_tests.erl
|   |-- at_server.erl
|   |-- at_server_tests.erl
|   +-- at_trans.erl
+-- salsa
    |-- Gpx.hs
    |-- SalsaAst.hs
    |-- SalsaInterp.hs
    |-- SalsaParser.hs
    |-- SalsaParserTest.hs
    |-- SimpleParse.hs
    |-- multi.salsa
    +-- simple.salsa
\end{lstlisting}
\end{document}
